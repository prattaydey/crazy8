<!DOCTYPE html>
<html>

  <!-- https://matomo.org/faq/tag-manager/faq_26815/ -->

  <header>
      <!-- Foundation CSS -->
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/foundation-sites@6.7.5/dist/css/foundation.min.css" crossorigin="anonymous">
          
      <!-- Loading screen CSS -->
      <link rel="stylesheet" href="static/css/loading.css">

  </header>

  <!-- THIS IS THE PLAN
  get rooms from the api
  Then check if the is an empty spot
  Then if empty reload page
  Else check again -->

  <!-- Implement these codes

  <form id="myForm" action="/connect-{{id}}" method="POST">
    <div class="text-center">
      <button class="button">
        Join
      </button>
    </div>
  </form>

  async function getDataFromAPI() {

    const form = document.getElementById('myForm');

    const response = await fetch('https://jsonblob.com/api/room/{blobId}');
    const data = await response.json();
    // The data variable contains the dictionary you want to iterate through
    const keys = Object.keys(data);
    for (let i = 0; i < keys.length; i++) {
      const Deck_id = keys[i];
      const room = data[Deck_id];

      const room_key = Object.keys(room)
      if (!('key1' in dictionary) || !('key4' in dictionary)){

        //submit the form to redirect the page
        form.addEventListener('submit', function(event) {

        event.preventDefault();  // Prevent the form from being submitted the usual way

        const formData = new FormData(form);  // Get the form data

        const xhr = new XMLHttpRequest();  // Create a new XHR object
        xhr.open('POST', "/connect-"+Deck_id);  // Set the request method and URL
        xhr.send(formData);  // Send the request with the form data
        });
      }
    }
  }

  -->

  <body onload="getDataFromAPI()"> 

    <form id="myForm" action="/connect-{{id}}" method="POST">
        <button class="button">
          Join
        </button>
    </form>

    <div>
      <canvas id='canvas'></canvas>
      <h5 class="centered">Loading...</h5>
      <script src="static/js/loading.js"></script>
    </div>

    <script>
      async function getDataFromAPI() {

        const form = document.getElementById('myForm');

        const response = await fetch('https://jsonblob.com/api/room/{blobId}');
        const data = await response.json();
        // The data variable contains the dictionary you want to iterate through
        const keys = Object.keys(data);
        for (let i = 0; i < keys.length; i++) {
          const Deck_id = keys[i];
          const room = data[Deck_id];

          const room_key = Object.keys(room)
          if (!('key1' in dictionary) || !('key4' in dictionary)){

            //submit the form to redirect the page
            form.addEventListener('submit', function(event) {

            event.preventDefault();  // Prevent the form from being submitted the usual way

            const formData = new FormData(form);  // Get the form data

            const xhr = new XMLHttpRequest();  // Create a new XHR object
            xhr.open('POST', "/connect-"+Deck_id);  // Set the request method and URL
            xhr.send(formData);  // Send the request with the form data
            });
          }
        }
      }

      function redirect(){
        const sleep = (delay) => new Promise((resolve) => setTimeout(resolve,delay))
        const redirecting = async () =>{
          await sleep(5000)
          //let location = console.log(location.href)
          //let length = location.length
          //location.href = (location.substr(length-4)).concat("crazy8")
          const lengthing = (window.location.href).length
          location.href = ((window.location.href).substr(0,lengthing-8)).concat("crazy8")
        }
        redirecting()
      }
    </script>
  </body>
</html>